# Railway configuration for multi-service deployment

[build]
builder = "nixpacks"
buildCommand = "pnpm install && pnpm build"

[deploy]
startCommand = "pnpm start"
healthcheckPath = "/api/health"
healthcheckTimeout = 100
restartPolicyType = "on_failure"

# Service configurations
[[services]]
name = "web"
dockerfile = "dockerfiles/Dockerfile.web"

[[services.ports]]
containerPort = 3000
protocol = "http"

[[services.healthcheck]]
path = "/"
intervalSeconds = 30
timeoutSeconds = 10

[[services]]
name = "api"
dockerfile = "dockerfiles/Dockerfile.api"

[[services.ports]]
containerPort = 4000
protocol = "http"

[[services.healthcheck]]
path = "/api/health"
intervalSeconds = 30
timeoutSeconds = 10

[[services]]
name = "worker"
dockerfile = "dockerfiles/Dockerfile.worker"

# Database service (managed by Railway)
[[services]]
name = "postgres"
image = "postgres:17-alpine"

[[services.volumes]]
mountPath = "/var/lib/postgresql/data"
name = "postgres-data"

# Redis service (managed by Railway)
[[services]]
name = "redis"
image = "redis:7.4-alpine"

[[services.volumes]]
mountPath = "/data"
name = "redis-data"
